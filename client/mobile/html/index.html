<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mobile</title>
</head>
<body>
    <!-- 登录板块 -->
    <section class="login">

    </section>
    <section class="gamepad">
    </section>
    <script src="../js/gamepad.js"></script>
    <script>
        const MSG_TYPES = {
            playerDataSend: 'PLAYER_DATA_SEND',
            hostJoin: 'HOST_JOIN',
            hostLeave: 'HOST_LEAVE',
            mobileJoin: 'MOBILE_JOIN',
            mobileLeave: 'MOBILE_LEAVE',
            connected: 'CONNECTED'
        }
        class App {
            constructor(url) {
                this.isConnected = false;
                // 建立websocket连接
                this.ws = new WebSocket(url);
                this.ws.addEventListener('message',({data}) => {
                    this.isConnected = true;
                    const res = JSON.parse(data);
                    this.onData(res);
                });
                let gamepad = new Gamepad(document.querySelector('.gamepad'));
                gamepad.onData(data => {
                    if(!this.isConnected) return;
                    this.send({
                        name: MSG_TYPES.playerDataSend,
                        body: data
                    });
                })
            }
            send(msg) {
                this.ws.send(JSON.stringify(msg));
            }
        }
        new App('ws://127.0.0.1:8086');
    </script>
</body>
</html>